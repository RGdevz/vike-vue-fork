{"version":3,"file":"clientOnly.js","sources":["../../src/helpers/clientOnly.ts"],"sourcesContent":["export { clientOnly }\n\nimport { h, nextTick, shallowRef, defineComponent, onBeforeMount } from 'vue'\nimport type { Component, SlotsType } from 'vue'\n\n/**\n * Load and render a component only on the client-side.\n *\n * https://vike.dev/clientOnly\n */\nfunction clientOnly<ComponentLoaded extends Component>(\n  load: () => Promise<ComponentLoaded | { default: ComponentLoaded }>,\n) {\n  const componentWrapper = defineComponent({\n    inheritAttrs: false,\n\n    setup(_, { attrs, slots }) {\n      const componentLoaded = shallowRef<ComponentLoaded | null>(null)\n      const error = shallowRef<unknown>(null)\n\n      onBeforeMount(async () => {\n        try {\n          const ret = await load()\n          componentLoaded.value = 'default' in ret ? ret.default : ret\n        } catch (e) {\n          console.error('Error while loading clientOnly() component:', e)\n          // wait for nextTick to avoid hydration errors\n          nextTick(() => {\n            error.value = e\n          })\n        }\n      })\n\n      return () => {\n        if (componentLoaded.value !== null) {\n          return h(componentLoaded.value, attrs, slots)\n        }\n        if (slots['client-only-fallback']) {\n          return slots['client-only-fallback']({ error: error.value, attrs })\n        }\n        // if the user doesn't want clientOnly() to use <template #fallback> then he should define a (empty) <template #client-only-fallback>\n        if (slots['fallback']) {\n          return slots['fallback']({ error: error.value, attrs })\n        }\n      }\n    },\n\n    slots: {} as SlotsType<{\n      fallback: { error: unknown; attrs: Record<string, any> }\n      'client-only-fallback': { error: unknown; attrs: Record<string, any> }\n    }>,\n  })\n  return componentWrapper as typeof componentWrapper & ComponentLoaded\n}\n"],"names":[],"mappings":";AAUA,SAAS,WACP,MACA;AACA,QAAM,mBAAmB,gBAAgB;AAAA,IACvC,cAAc;AAAA,IAEd,MAAM,GAAG,EAAE,OAAO,SAAS;AACnB,YAAA,kBAAkB,WAAmC,IAAI;AACzD,YAAA,QAAQ,WAAoB,IAAI;AAEtC,oBAAc,YAAY;AACpB,YAAA;AACI,gBAAA,MAAM,MAAM,KAAK;AACvB,0BAAgB,QAAQ,aAAa,MAAM,IAAI,UAAU;AAAA,iBAClD,GAAG;AACF,kBAAA,MAAM,+CAA+C,CAAC;AAE9D,mBAAS,MAAM;AACb,kBAAM,QAAQ;AAAA,UAAA,CACf;AAAA,QAAA;AAAA,MACH,CACD;AAED,aAAO,MAAM;AACP,YAAA,gBAAgB,UAAU,MAAM;AAClC,iBAAO,EAAE,gBAAgB,OAAO,OAAO,KAAK;AAAA,QAAA;AAE1C,YAAA,MAAM,sBAAsB,GAAG;AAC1B,iBAAA,MAAM,sBAAsB,EAAE,EAAE,OAAO,MAAM,OAAO,OAAO;AAAA,QAAA;AAGhE,YAAA,MAAM,UAAU,GAAG;AACd,iBAAA,MAAM,UAAU,EAAE,EAAE,OAAO,MAAM,OAAO,OAAO;AAAA,QAAA;AAAA,MAE1D;AAAA,IACF;AAAA,IAEA,OAAO,CAAA;AAAA,EAAC,CAIT;AACM,SAAA;AACT;"}