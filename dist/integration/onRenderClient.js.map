{"version":3,"file":"onRenderClient.js","sources":["../../src/integration/onRenderClient.ts"],"sourcesContent":["// https://vike.dev/onRenderClient\nexport { onRenderClient }\n\nimport { createVueApp, type ChangePage } from './createVueApp.js'\nimport { getHeadSetting } from './getHeadSetting.js'\nimport type { OnRenderClientAsync, PageContextClient } from 'vike/types'\nimport { callCumulativeHooks } from '../utils/callCumulativeHooks.js'\nimport type { App } from 'vue'\nimport { objectAssign } from '../utils/objectAssign.js'\nimport type { PageContextInternal } from '../types/PageContext.js'\nimport { applyHeadSettings } from './applyHeadSettings.js'\n\nlet app: App | undefined\nlet changePage: ChangePage | undefined\nconst onRenderClient: OnRenderClientAsync = async (\n  pageContext: PageContextClient & PageContextInternal,\n): ReturnType<OnRenderClientAsync> => {\n  // Workaround for https://github.com/vikejs/vike-vue/pull/178#issuecomment-2285852251b\n  pageContext._configFromHook ??= {}\n  // Workaround for https://github.com/vikejs/vike-vue/issues/181\n  pageContext._headAlreadySetWrapper = { val: pageContext.isHydration }\n\n  // Or eventually use https://github.com/vikejs/vike/issues/1776\n  pageContext.isRenderingHead = undefined\n\n  if (!app) {\n    // First rendering/hydration\n\n    const container = document.getElementById('app')!\n    const ssr = container.innerHTML !== ''\n    const res = await createVueApp(pageContext, ssr, 'Page')\n    changePage = res.changePage\n    app = res.app\n    objectAssign(pageContext, { app })\n    await callCumulativeHooks(pageContext.config.onBeforeRenderClient, pageContext)\n    app.mount(container)\n  } else {\n    // Client-side navigation\n\n    objectAssign(pageContext, { app })\n    await callCumulativeHooks(pageContext.config.onBeforeRenderClient, pageContext)\n    await changePage!(pageContext)\n  }\n\n  if (!pageContext.isHydration) {\n    pageContext._headAlreadySetWrapper!.val = true\n    applyHead(pageContext)\n  }\n\n  // Use cases:\n  // - Custom user settings: https://vike.dev/head-tags#custom-settings\n  // - Testing tools: https://github.com/vikejs/vike-react/issues/95\n  await callCumulativeHooks(pageContext.config.onAfterRenderClient, pageContext)\n}\n\nfunction applyHead(pageContext: PageContextClient) {\n  const title = getHeadSetting<string | null>('title', pageContext)\n  const lang = getHeadSetting<string | null>('lang', pageContext)\n  applyHeadSettings(title, lang)\n}\n"],"names":[],"mappings":";;AAYA,IAAI;AACJ,IAAI;AACE,MAAA,iBAAsC,OAC1C,gBACoC;AAEpC,cAAY,oBAAZ,YAAY,kBAAoB,CAAC;AAEjC,cAAY,yBAAyB,EAAE,KAAK,YAAY,YAAY;AAGpE,cAAY,kBAAkB;AAE9B,MAAI,CAAC,KAAK;AAGF,UAAA,YAAY,SAAS,eAAe,KAAK;AACzC,UAAA,MAAM,UAAU,cAAc;AACpC,UAAM,MAAM,MAAM,aAAa,aAAa,KAAK,MAAM;AACvD,iBAAa,IAAI;AACjB,UAAM,IAAI;AACG,iBAAA,aAAa,EAAE,KAAK;AACjC,UAAM,oBAAoB,YAAY,OAAO,sBAAsB,WAAW;AAC9E,QAAI,MAAM,SAAS;AAAA,EAAA,OACd;AAGQ,iBAAA,aAAa,EAAE,KAAK;AACjC,UAAM,oBAAoB,YAAY,OAAO,sBAAsB,WAAW;AAC9E,UAAM,WAAY,WAAW;AAAA,EAAA;AAG3B,MAAA,CAAC,YAAY,aAAa;AAC5B,gBAAY,uBAAwB,MAAM;AAC1C,cAAU,WAAW;AAAA,EAAA;AAMvB,QAAM,oBAAoB,YAAY,OAAO,qBAAqB,WAAW;AAC/E;AAEA,SAAS,UAAU,aAAgC;AAC3C,QAAA,QAAQ,eAA8B,SAAS,WAAW;AAC1D,QAAA,OAAO,eAA8B,QAAQ,WAAW;AAC9D,oBAAkB,OAAO,IAAI;AAC/B;"}