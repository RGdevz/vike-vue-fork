{"version":3,"file":"getHeadSetting-RBxCuYEB.js","sources":["../src/utils/objectAssign.ts","../src/utils/callCumulativeHooks.ts","../src/utils/isPlainObject.ts","../src/integration/createVueApp.ts","../src/utils/isCallable.ts","../src/integration/getHeadSetting.ts"],"sourcesContent":["// Same as `Object.assign()` but with type inference\nexport function objectAssign<Obj extends object, ObjAddendum>(\n  obj: Obj,\n  objAddendum: ObjAddendum,\n): asserts obj is Obj & ObjAddendum {\n  Object.assign(obj, objAddendum)\n}\n","export { callCumulativeHooks }\n\nimport { providePageContext } from 'vike/getPageContext'\n\nasync function callCumulativeHooks(\n  values: undefined | unknown[],\n  pageContext: Record<string, any>,\n): Promise<unknown[]> {\n  if (!values) return []\n  const valuesPromises = values.map((val) => {\n    if (typeof val === 'function') {\n      providePageContext(pageContext)\n      // Hook\n      return val(pageContext)\n    } else {\n      // Plain value\n      return val\n    }\n  })\n  const valuesResolved = await Promise.all(valuesPromises)\n  return valuesResolved\n}\n","export function isPlainObject(value: unknown): value is Record<string, unknown> {\n  // Is object?\n  if (typeof value !== 'object' || value === null) {\n    return false\n  }\n\n  // Support `Object.create(null)`\n  if (Object.getPrototypeOf(value) === null) {\n    return true\n  }\n\n  // Is plain object?\n  return (\n    /* Doesn't work in Cloudflare Pages workers\n    value.constructor === Object\n    */\n    value.constructor.name === 'Object'\n  )\n}\n","export { createVueApp }\nexport type { ChangePage }\n\nimport {\n  type App,\n  createApp,\n  createSSRApp,\n  h,\n  nextTick,\n  shallowRef,\n  shallowReactive,\n  type Component,\n  Fragment,\n} from 'vue'\nimport type { PageContext } from 'vike/types'\nimport { setPageContext } from '../hooks/usePageContext'\nimport { objectAssign } from '../utils/objectAssign'\nimport { callCumulativeHooks } from '../utils/callCumulativeHooks'\nimport { isPlainObject } from '../utils/isPlainObject'\nimport { setData } from '../hooks/useData'\nimport type { PageContextInternal } from '../types/PageContext'\n\ntype ChangePage = (pageContext: PageContext) => Promise<void>\nasync function createVueApp(\n  pageContext: PageContext & PageContextInternal,\n  ssr: boolean,\n  entryComponentName: 'Head' | 'Page',\n) {\n  let onChangePage: undefined | ((pageContext: PageContext) => void)\n  let RootComponent: Component | (() => ReturnType<typeof h>)\n  // Wrap <Page> with <Layout>\n  if (entryComponentName === 'Page') {\n    const entryComponentRef = shallowRef(pageContext.config[entryComponentName])\n    const layoutRef = shallowRef(pageContext.config.Layout || [])\n    onChangePage = (pageContext: PageContext) => {\n    entryComponentRef.value = pageContext.config[entryComponentName]\n    layoutRef.value = pageContext.config.Layout || []\n    }\n\n    const EntryComponent = () => h(entryComponentRef.value)\n\n     RootComponent = () => {\n      let componentWithLayout = EntryComponent\n\n       console.log(layoutRef.value)\n\n      layoutRef.value.forEach((layout) => {\n      const Comp = componentWithLayout\n      componentWithLayout = () => h(layout, null, Comp)\n      }\n      )\n\n\n      return componentWithLayout()\n    }\n\n\n\n  } else {\n\n    RootComponent = () => {\n      const HeadElements = [\n     // Added by +Head\n     ...(pageContext.config.Head ?? []),\n     // Added by useConfig()\n     ...(pageContext._configFromHook?.Head ?? []),\n      ].map((HeadComponent) => h(HeadComponent))\n      return h(Fragment, null, HeadElements)\n    }\n    }\n\n\n  const app: App = ssr ? createSSRApp(RootComponent) : createApp(RootComponent)\n  objectAssign(pageContext, { app })\n  const { onCreateApp } = pageContext.config\n  await callCumulativeHooks(onCreateApp, pageContext)\n\n  const data = pageContext.data ?? {}\n  assertDataIsObject(data)\n  // TODO/breaking-change: use shallowRef() instead of shallowReactive()\n  // - Remove workaround https://github.com/vikejs/vike-vue/blob/89ca09ed18ffa1c0401851a506f505813a7dece7/packages/vike-vue/src/integration/onRenderClient.ts#L18-L21\n  const dataReactive = shallowReactive(data)\n  const pageContextReactive = shallowReactive(pageContext)\n  setPageContext(app, pageContextReactive)\n  setData(app, dataReactive)\n\n  // changePage() is called upon navigation, see +onRenderClient.ts\n  const changePage: ChangePage = async (pageContext: PageContext) => {\n    let returned = false\n    let err: unknown\n    app.config.errorHandler = (err_) => {\n    if (returned) {\n    console.error(err_)\n    } else {\n    err = err_\n    }\n    }\n    const data = pageContext.data ?? {}\n    assertDataIsObject(data)\n    objectReplace(dataReactive, data)\n    objectReplace(pageContextReactive, pageContext)\n    onChangePage?.(pageContext)\n    await nextTick()\n    returned = true\n    if (err) throw err\n  }\n\n  return { app, changePage }\n}\n\nfunction assertDataIsObject(data: unknown): asserts data is Record<string, unknown> {\n  if (!isPlainObject(data)) throw new Error('data() should return a plain object, undefined, or null')\n}\n\nexport function objectReplace(obj: object, objAddendum: object) {\n  // @ts-ignore\n  Object.keys(obj).forEach((key) => delete obj[key])\n  Object.assign(obj, objAddendum)\n}\n","export function isCallable<T extends (...args: unknown[]) => unknown>(thing: T | unknown): thing is T {\n  return thing instanceof Function || typeof thing === 'function'\n}\n","export { getHeadSetting }\n\nimport { isCallable } from '../utils/isCallable.js'\nimport type { PageContext } from 'vike/types'\nimport type { PageContextInternal } from '../types/PageContext.js'\nimport type { ConfigFromHookResolved } from '../types/Config.js'\nimport { configsCumulative } from '../hooks/useConfig/configsCumulative.js'\nimport { includes } from '../utils/includes.js'\n\n// We use `any` instead of doing proper validation in order to save KBs sent to the client-side.\n\nfunction getHeadSetting<T>(\n  configName: keyof ConfigFromHookResolved,\n  pageContext: PageContext & PageContextInternal,\n): undefined | T {\n  // Set by useConfig()\n  const valFromUseConfig = pageContext._configFromHook?.[configName]\n  // Set by +configName.js\n  const valFromConfig = pageContext.config[configName]\n\n  const getCallable = (val: unknown) => (isCallable(val) ? val(pageContext) : val)\n  if (!includes(configsCumulative, configName)) {\n    if (valFromUseConfig !== undefined) return valFromUseConfig as any\n    return getCallable(valFromConfig) as any\n  } else {\n    return [\n      //\n      ...((valFromConfig as any) ?? []).map(getCallable),\n      ...((valFromUseConfig as any) ?? []),\n    ] as any\n  }\n}\n"],"names":["pageContext","data"],"mappings":"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"}